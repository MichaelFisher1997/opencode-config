#!/bin/bash
# Pre-commit hook to scan for secrets before commit
# This hook is installed by OpenCode's git-hooks-plugin

echo "ðŸ” Running pre-commit secret scan..."

# Check if gitleaks is available
if ! command -v gitleaks &> /dev/null; then
    echo "âš ï¸  Gitleaks not found. Install with: brew install gitleaks (macOS) or go install github.com/gitleaks/gitleaks@latest"
    echo "âš ï¸  Skipping secret scan. Consider installing gitleaks for security."
    exit 0
fi

# Run gitleaks detect
echo "ðŸ”Ž Scanning for secrets..."
if gitleaks detect --verbose --redact=false 2>&1; then
    echo "âœ… No secrets detected"
    exit 0
else
    echo ""
    echo "ðŸš¨ Secrets detected! Commit blocked."
    echo ""
    echo "To fix this:"
    echo "1. Remove secrets from your changes"
    echo "2. Or rotate any exposed credentials"
    echo "3. Then try committing again"
    echo ""
    echo "If this is a false positive, you can:"
    echo "- Add the secret to .gitleaksignore in your project root"
    echo "- Use: echo 'secret_here' >> .gitleaksignore"
    echo ""
    exit 1
fi
